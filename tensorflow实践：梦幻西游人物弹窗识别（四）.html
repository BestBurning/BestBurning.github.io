<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="正走在通向编程、艺术、摄影、剪辑、写作、运动的路上的Full Stacker,Stay Cool!!!"><meta name="google-site-verification" content="q2XooBg_4_mx5-YvLlJvWzU3gxn_9nUvFpLz2_pU584"><meta name="keywords" content="tensorflow,梦幻西游,弹窗识别,python,自动点击,图像识别,虚拟鼠标驱动"><title>tensorflow实践：梦幻西游人物弹窗识别（四） - 第一帅</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-163115360-1','auto');ga('send','pageview');
</script><script>(function () {
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">tensorflow实践：梦幻西游人物弹窗识别（四）</h1><a id="logo" href="/.">第一帅</a><p class="description">Shea的博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/products/"><i class="fa fa-cubes"> 作品</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/guestbook/"><i class="fa fa-comments"> 留言</i></a><a href="/history/"><i class="fa fa-book"> 历史</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">tensorflow实践：梦幻西游人物弹窗识别（四）</h1><div class="post-meta">2020-03-21<span> | </span><span class="category"><a href="/categories/technology/">technology</a><span>  </span></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a class="disqus-comment-count" data-disqus-identifier="tensorflow实践：梦幻西游人物弹窗识别（四）.html" href="/tensorflow实践：梦幻西游人物弹窗识别（四）.html#disqus_thread"></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#环境描述"><span class="toc-number">1.</span> <span class="toc-text">环境描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#截图匹配"><span class="toc-number">2.</span> <span class="toc-text">截图匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#点击区域中心"><span class="toc-number">3.</span> <span class="toc-text">点击区域中心</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#移至目标点"><span class="toc-number">3.1.</span> <span class="toc-text">移至目标点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#点击"><span class="toc-number">3.2.</span> <span class="toc-text">点击</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#组合"><span class="toc-number">4.</span> <span class="toc-text">组合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#回顾"><span class="toc-number">5.</span> <span class="toc-text">回顾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#声明"><span class="toc-number">6.</span> <span class="toc-text">声明</span></a></li></ol></div></div><div class="post-content"><p>在<a href="https://di1shuai.com/tensorflow%E5%AE%9E%E8%B7%B5%EF%BC%9A%E6%A2%A6%E5%B9%BB%E8%A5%BF%E6%B8%B8%E4%BA%BA%E7%89%A9%E5%BC%B9%E7%AA%97%E8%AF%86%E5%88%AB%EF%BC%88%E4%B8%89%EF%BC%89.html">上一篇文章</a>中我们已经能够预测切分好的一组照片，现在只需要<strong>点击</strong>被预测的<strong>区域中心</strong>就好了<br>我们将按以下思路进行<br><img src="http://images.di1shuai.com/FpZrIhU_FWqG837tyzBUtR4l-f55" alt></p>
<p>本篇将围绕<strong>截图匹配、点击中心坐标</strong>讲述<a href="https://github.com/BestBurning/mhxy/blob/master/main.py" target="_blank" rel="noopener">main.py</a>、<a href="https://github.com/BestBurning/mhxy/blob/master/screen.py" target="_blank" rel="noopener">screen.py</a>、<a href="https://github.com/BestBurning/mhxy/blob/master/auto.py" target="_blank" rel="noopener">auto.py</a>、<a href="https://github.com/BestBurning/mhxy/blob/master/keymouse.py" target="_blank" rel="noopener">keymouse.py</a>代码</p>
<h3 id="环境描述"><a href="#环境描述" class="headerlink" title="环境描述"></a>环境描述</h3><p>由于<strong>鼠标点击</strong>使用了<a href="https://github.com/BestBurning/kmclassdll" target="_blank" rel="noopener">kmclassdll</a>，所以需要开启 <strong>测试模式</strong> &amp; <strong>禁用强制驱动签名</strong> 并 <strong>重启</strong></p>
<p><code>管理员身份</code>打开<code>CMD</code></p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">bcdedit /<span class="keyword">set</span> nointegritychecks <span class="keyword">on</span></span><br><span class="line">bcdedit /<span class="keyword">set</span> testsigning <span class="keyword">on</span></span><br><span class="line">shutdown  -r -t <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="截图匹配"><a href="#截图匹配" class="headerlink" title="截图匹配"></a>截图匹配</h3><p>使用预测图片<strong>索引</strong>去找到对应<strong>图片</strong>，于是使用这张被预测的图片去<strong>桌面截图</strong>中匹配，并返回匹配到的<strong>区域中心</strong><br><img src="http://images.di1shuai.com/FkCp-lFd4RqmtYf-H1iCqMfMFNgd" alt></p>
<p><code>main.py</code></p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">min_index = dm.model_predict(<span class="keyword">c</span>.crop_<span class="number">4</span>_img_paths)</span><br><span class="line">target_x , target_y = sc.find_xy_indesktop(<span class="keyword">c</span>.crop_<span class="number">4</span>_img_paths[min_index])</span><br></pre></td></tr></table></figure>

<p><code>screen.py</code></p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line">def find_xy_indesktop(template_path):</span><br><span class="line">    util.log_title(<span class="string">'坐标查找'</span>)</span><br><span class="line">    <span class="built_in">shape</span>,score = template_match(template_path,c.img_desktop_path)</span><br><span class="line">    <span class="built_in">print</span>(f<span class="string">'最高得分区域 &#123;shape&#125; 得分为 &#123;score&#125;'</span>)</span><br><span class="line">    <span class="keyword">if</span> score &gt;= <span class="number">3</span>:</span><br><span class="line">        x = (<span class="built_in">shape</span>[<span class="number">2</span>]+<span class="built_in">shape</span>[<span class="number">0</span>])<span class="comment">//2</span></span><br><span class="line">        y = (<span class="built_in">shape</span>[<span class="number">3</span>]+<span class="built_in">shape</span>[<span class="number">1</span>])<span class="comment">//2</span></span><br><span class="line">        <span class="built_in">print</span>(f<span class="string">'中心点坐标为 &#123;(x,y)&#125;'</span>)</span><br><span class="line">        <span class="keyword">return</span> x,y</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(f<span class="string">'所有区域得分均小于3，匹配失败'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight delphi"><table><tr><td class="code"><pre><span class="line">--------   模型预测    ----------</span><br><span class="line"></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">21</span> <span class="number">15</span>:<span class="number">57</span>:<span class="number">49.720468</span>: I tensorflow/stream_executor/<span class="keyword">platform</span>/<span class="keyword">default</span>/dso_loader.cc:<span class="number">44</span>] Successfully opened <span class="keyword">dynamic</span> <span class="keyword">library</span> cublas64_10.dll</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">21</span> <span class="number">15</span>:<span class="number">57</span>:<span class="number">50.521308</span>: I tensorflow/stream_executor/<span class="keyword">platform</span>/<span class="keyword">default</span>/dso_loader.cc:<span class="number">44</span>] Successfully opened <span class="keyword">dynamic</span> <span class="keyword">library</span> cudnn64_7.dll</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">21</span> <span class="number">15</span>:<span class="number">57</span>:<span class="number">52.768875</span>: W tensorflow/stream_executor/gpu/redzone_allocator.cc:<span class="number">312</span>] Internal: Invoking GPU <span class="keyword">asm</span> compilation <span class="keyword">is</span> supported <span class="keyword">on</span> Cuda non-Windows platforms only</span><br><span class="line">Relying <span class="keyword">on</span> driver <span class="keyword">to</span> perform ptx compilation. This <span class="keyword">message</span> will be only logged once.</span><br><span class="line">[<span class="number">4.032246</span>, <span class="number">6.499766</span>, <span class="number">5.2396355</span>, <span class="number">33.076145</span>]</span><br><span class="line"> 预测结果为 第 &gt; <span class="number">1</span> &lt; 张图片</span><br><span class="line"></span><br><span class="line">--------   坐标查找    ----------</span><br><span class="line"></span><br><span class="line">最高得分区域 (<span class="number">340</span>, <span class="number">300</span>, <span class="number">430</span>, <span class="number">420</span>) 得分为 <span class="number">4</span></span><br><span class="line">中心点坐标为 (<span class="number">385</span>, <span class="number">360</span>)</span><br></pre></td></tr></table></figure>

<h3 id="点击区域中心"><a href="#点击区域中心" class="headerlink" title="点击区域中心"></a>点击区域中心</h3><p>接下来就是把鼠标<strong>移</strong>到<strong>目标点</strong>，再<strong>点击</strong>一下就好了！</p>
<p>是不是<strong>很简单</strong>！<strong>！</strong>！<strong>！</strong>！</p>
<p><img src="http://images.di1shuai.com/FoFyAQ7RQg-ShqxfQWBQk6vntrdw" alt></p>
<h4 id="移至目标点"><a href="#移至目标点" class="headerlink" title="移至目标点"></a>移至目标点</h4><p>于是我使用<code>pyautogui</code><strong>移动</strong> -&gt; <strong>目标点</strong></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">pyautogui</span><span class="selector-class">.moveTo</span>(<span class="selector-tag">target_x</span> , <span class="selector-tag">target_y</span>)</span><br></pre></td></tr></table></figure>

<p><img src="http://images.di1shuai.com/FoHxcmn5OS9Bob9F0auLFM78eUSB" alt><br>咦？它怎么<strong>没有</strong>移到<strong>对应</strong>位置！！每次它都是移到目标点<strong>附近</strong><br>于是我把梦幻窗口<strong>移开</strong>，移动，<strong>Work</strong>！<br>把梦幻窗口<strong>挪回来</strong>，移动，<strong>No</strong> Work！<br>经过研究<br>原来<br>梦幻窗口内的坐标并<strong>不</strong>是<strong>真实</strong>的坐标，他的真实坐标可以用<strong>CE</strong>读取<strong>内存基址</strong>来获取<br>这个<strong>CE</strong>是什么？<br>全拼<code>Cheat Engine</code>，中文<code>作弊引擎</code><br><img src="http://images.di1shuai.com/Fl4S5PlZN7kYeSzMvjgxNNjBvG2H" alt></p>
<p><img src="http://images.di1shuai.com/Fputsx1KWvkik4u8YUiTd6yozimN" alt></p>
<p>于是我用了另一种思路——<strong>二</strong>次<strong>逼</strong>近：</p>
<p><strong>第一次</strong>移动到目标点<strong>附近</strong>，然后用<strong>梦幻鼠标标识</strong>去<strong>匹配此时桌面</strong>截图，这样就能获得<strong>此时</strong>鼠标的<strong>真实位置</strong><br><strong>第二次</strong>鼠标使用<strong>相对位移</strong>移到目标点，搞定~<br><img src="http://images.di1shuai.com/FvsfJcYbrsVcz9aN7dWEH15viVdp" alt></p>
<p><img src="http://images.di1shuai.com/FrksXgrWXjrHVweU9RMy0wpaw1zK" alt><br><code>main.py</code></p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">auto.<span class="keyword">move_to(target_x,target_y)</span></span><br><span class="line"><span class="keyword">if </span><span class="keyword">sc.shot():</span></span><br><span class="line"><span class="keyword">	</span>now_x,now_y =  <span class="keyword">sc.find_mouse_in_desktop()</span></span><br><span class="line"><span class="keyword">	</span><span class="keyword">move_x </span>= target_x-now_x+c.mouse_move_shape[<span class="number">0</span>]</span><br><span class="line">	<span class="keyword">move_y </span>= target_y-now_y+c.mouse_move_shape[<span class="number">1</span>]</span><br><span class="line">	auto.<span class="keyword">move_rel_click(move_x, </span><span class="keyword">move_y)</span></span><br></pre></td></tr></table></figure>

<p><code>screen.py</code></p>
<figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">def find_mouse_in_desktop():    </span><br><span class="line">    <span class="attr">img</span> = cv.imread(c.img_desktop_path,<span class="number">0</span>)</span><br><span class="line">    <span class="attr">img2</span> = img.copy()</span><br><span class="line">    <span class="attr">template</span> = cv.imread(c.mouse_flag_img_path,<span class="number">0</span>)</span><br><span class="line">    w, <span class="attr">h</span> = template.shape[::-<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="attr">img</span> = img2.copy()</span><br><span class="line">    <span class="attr">shape_list</span> = []</span><br><span class="line">    <span class="attr">threshold</span> = <span class="number">0.85</span></span><br><span class="line">    <span class="attr">res</span> = cv.matchTemplate(img,template,cv.TM_CCOEFF_NORMED)</span><br><span class="line">    <span class="attr">loc</span> = np.where( res &gt;= threshold)</span><br><span class="line">    <span class="attr">x</span> = <span class="number">10000</span></span><br><span class="line">    <span class="attr">y</span> = <span class="number">10000</span></span><br><span class="line">    for pt <span class="keyword">in</span> zip(*loc[::-<span class="number">1</span>]):</span><br><span class="line">        <span class="attr">top_left</span> = pt</span><br><span class="line">        <span class="attr">bottom_right</span> = (top_left[<span class="number">0</span>] + w, top_left[<span class="number">1</span>] + h)  </span><br><span class="line">        <span class="attr">shape</span> = (top_left[<span class="number">0</span>],top_left[<span class="number">1</span>],bottom_right[<span class="number">0</span>],bottom_right[<span class="number">1</span>])</span><br><span class="line">        shape_list.append(shape)</span><br><span class="line">        <span class="attr">new_x</span> = (shape[<span class="number">2</span>]+shape[<span class="number">0</span>])//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> new_x &lt; x :        </span><br><span class="line">            <span class="attr">x</span> = new_x</span><br><span class="line">            <span class="attr">y</span> = (shape[<span class="number">3</span>]+shape[<span class="number">1</span>])//<span class="number">2</span></span><br><span class="line"></span><br><span class="line">    print(f'中心点坐标为 &#123;(x,y)&#125;')</span><br><span class="line">    return x,y</span><br></pre></td></tr></table></figure>

<h4 id="点击"><a href="#点击" class="headerlink" title="点击"></a>点击</h4><p>终于，终于，咦？<br>你们能明白鼠标都移到脸上了，可它就是<strong>点不下去</strong>的<strong>痛苦</strong>吗！<br><img src="http://images.di1shuai.com/Fk0iyfOpffKFnPSU9w1_W3THTBQz" alt></p>
<p>为什么呢？</p>
<p>简单来说很多游戏使用的并不是<code>win32</code>的事件读取输入方式，而是去系统<strong>内核</strong>读取的<strong>驱动</strong>的输入，这样既可以保证<strong>低时延</strong>也可以<strong>屏蔽作弊</strong></p>
<p><img src="http://images.di1shuai.com/Fvk18oJf6uPNnvucvd0KBHgUcOIx" alt></p>
<p>既然是<strong>内核驱动</strong>读取<br><img src="http://images.di1shuai.com/FoxRGNcSWgzkf0XzEXiZYCGlnR77" alt></p>
<p><a href="https://docs.microsoft.com/zh-cn/windows-hardware/drivers/" target="_blank" rel="noopener">Windows 硬件开发人员文档</a><br><a href="https://docs.microsoft.com/zh-cn/windows-hardware/drivers/gettingstarted/writing-a-very-small-kmdf--driver" target="_blank" rel="noopener">编写通用 Hello World 驱动程序 (KMDF)</a><br><a href="https://docs.microsoft.com/zh-cn/windows/win32/debug/system-error-codes" target="_blank" rel="noopener">系统错误代码大全</a><br><a href="https://docs.microsoft.com/zh-cn/windows-hardware/drivers/gettingstarted/provision-a-target-computer-wdk-8-1" target="_blank" rel="noopener">预配计算机以便进行驱动程序部署和测试 (WDK 10)</a><br>经过<strong>一系列</strong>学习，<strong>成功</strong>编译<del>别人</del>开源的驱动代码 <a href="https://github.com/BestBurning/kmclass" target="_blank" rel="noopener">kmclass</a><br><img src="http://images.di1shuai.com/Fm5ewStPmrMrni8Jsw3D9M0VFlUj" alt></p>
<p><img src="http://images.di1shuai.com/Fqa104oQYpMc9Va5lHpOghHKmPYD" alt><br><code>keymouse.py</code> 即为调用驱动的动态库，在使用前请注意开篇的<strong>环境描述</strong></p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="built_in">driver</span> = None</span><br><span class="line"></span><br><span class="line">def load_driver():</span><br><span class="line">    global <span class="built_in">driver</span></span><br><span class="line">    <span class="built_in">driver</span> = CDLL(c.kmclass_dll_path)</span><br><span class="line">    <span class="built_in">driver</span>.LoadNTDriver(c.driver_name,bytes(c.kmclass_driver_path,encoding=<span class="string">"utf8"</span>))</span><br><span class="line">    <span class="built_in">driver</span>.SetHandle()</span><br><span class="line"></span><br><span class="line">def <span class="variable">_move_rel</span>(x, y):</span><br><span class="line">    <span class="built_in">driver</span>.MouseMoveRELATIVE(x,y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="variable">__name__</span> == <span class="string">'__main__'</span> : </span><br><span class="line"></span><br><span class="line">    load_driver()</span><br><span class="line">    <span class="variable">_move_rel</span>(<span class="number">111</span>,<span class="number">44</span>)</span><br></pre></td></tr></table></figure>

<p>现在我们用<code>pyautogui</code>移动，用<code>kmclass</code>点击<br><code>auto.py</code></p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line">def move_rel_click(x,y):</span><br><span class="line">    t(<span class="string">'相对移动 点击'</span>)</span><br><span class="line">    move_rel(x,y)</span><br><span class="line">    <span class="built_in">time</span>.<span class="built_in">sleep</span>(<span class="built_in">random</span>.<span class="built_in">random</span>()/<span class="number">20</span>)</span><br><span class="line">    km.<span class="variable">_left_button_down</span>()</span><br><span class="line">    <span class="built_in">time</span>.<span class="built_in">sleep</span>(<span class="built_in">random</span>.<span class="built_in">random</span>()/<span class="number">5</span>)</span><br><span class="line">    km.<span class="variable">_left_button_up</span>()</span><br></pre></td></tr></table></figure>

<p>成了！</p>
<h3 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h3><p>我们把以上步骤组合起来<br><code>main.py</code></p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="comment">### 自动点击弹框</span></span><br><span class="line">def auto_click():</span><br><span class="line">    util.log_h1(f<span class="string">'前置准备'</span>)</span><br><span class="line">    <span class="keyword">if</span> sc.dir_check():</span><br><span class="line">        auto.open_driver()</span><br><span class="line">        dm.model_load()</span><br><span class="line">        <span class="keyword">while</span>(True):</span><br><span class="line">            util.log_h1_start(f<span class="string">'开始'</span>)</span><br><span class="line">            start_time = <span class="built_in">time</span>.<span class="built_in">time</span>()</span><br><span class="line">            <span class="keyword">if</span> sc.task():</span><br><span class="line">                min_index = dm.model_predict(c.crop_4_img_paths)</span><br><span class="line">                target_x , target_y = sc.find_xy_indesktop(c.crop_4_img_paths[min_index])</span><br><span class="line">                <span class="keyword">if</span> target_x == <span class="number">0</span> <span class="keyword">and</span> target_y == <span class="number">0</span>:</span><br><span class="line">                    util.log_title(<span class="string">'匹配失败'</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    auto.move_to(target_x,target_y)</span><br><span class="line">                    <span class="keyword">if</span> sc.shot():</span><br><span class="line">                        now_x,now_y =  sc.find_mouse_in_desktop()</span><br><span class="line">                        move_x = target_x-now_x+c.mouse_move_shape[<span class="number">0</span>]</span><br><span class="line">                        move_y = target_y-now_y+c.mouse_move_shape[<span class="number">1</span>]</span><br><span class="line">                        auto.move_rel_click(move_x, move_y)</span><br><span class="line">            end_time = <span class="built_in">time</span>.<span class="built_in">time</span>()</span><br><span class="line">            cost_time = end_time - start_time</span><br><span class="line">            util.log_h1_end(f<span class="string">'结束 耗时 %.3f'</span> % cost_time)</span><br><span class="line">            <span class="built_in">time</span>.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    auto_click()</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">=============================================================</span></span><br><span class="line"><span class="string">====================</span>    <span class="string">开始</span>    <span class="string">=========================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">--------</span>   <span class="string">截图</span>    <span class="string">----------</span></span><br><span class="line"></span><br><span class="line"><span class="string">梦幻西游</span> <span class="string">ONLINE</span> <span class="bullet">-</span> <span class="string">(xxxx[xxxx]</span> <span class="bullet">-</span> <span class="string">xxxx[xxxx])</span></span><br><span class="line"><span class="string">img_desktop</span> <span class="string">save</span> <span class="string">to</span> <span class="string">-&gt;</span> <span class="string">D:\gitRepo\mhxy\images\desktop.jpg</span></span><br><span class="line"><span class="string">img_mhxy</span> <span class="string">save</span> <span class="string">to</span> <span class="string">-&gt;</span> <span class="string">D:\gitRepo\mhxy\images\mhxy.jpg</span></span><br><span class="line"></span><br><span class="line"><span class="string">--------</span>   <span class="string">截图检查</span>    <span class="string">----------</span></span><br><span class="line"></span><br><span class="line">                <span class="string">size=(812,</span> <span class="number">663</span><span class="string">)</span>         <span class="string">ok</span></span><br><span class="line"></span><br><span class="line"><span class="string">--------</span>   <span class="string">战斗标识截图</span>    <span class="string">----------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">--------</span>   <span class="string">状态判断</span>    <span class="string">----------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">SSIM:</span> <span class="number">0.9954736185008931</span></span><br><span class="line"><span class="string">战斗</span> <span class="string">状态</span></span><br><span class="line"></span><br><span class="line"><span class="string">--------</span>   <span class="string">弹窗判断</span>    <span class="string">----------</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#123;(279,</span> <span class="number">251</span><span class="string">,</span> <span class="number">459</span><span class="string">,</span> <span class="number">264</span><span class="string">):</span> <span class="string">(2,</span> <span class="number">0</span><span class="string">),</span> <span class="string">(336,</span> <span class="number">253</span><span class="string">,</span> <span class="number">432</span><span class="string">,</span> <span class="number">267</span><span class="string">):</span> <span class="string">(4,</span> <span class="number">1</span><span class="string">)&#125;</span></span><br><span class="line"><span class="string">最大区域</span> <span class="string">(336,</span> <span class="number">253</span><span class="string">,</span> <span class="number">432</span><span class="string">,</span> <span class="number">267</span><span class="string">)</span> <span class="string">最终得分为</span> <span class="number">4</span></span><br><span class="line"><span class="string">弹框区域</span>  <span class="string">(254,</span> <span class="number">282</span><span class="string">,</span> <span class="number">614</span><span class="string">,</span> <span class="number">402</span><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">--------</span>   <span class="string">截图检查</span>    <span class="string">----------</span></span><br><span class="line"></span><br><span class="line">                <span class="string">size=(360,</span> <span class="number">120</span><span class="string">)</span>         <span class="string">ok</span></span><br><span class="line"></span><br><span class="line"><span class="string">--------</span>   <span class="string">弹窗人物切分</span>    <span class="string">----------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">--------</span>   <span class="string">模型预测</span>    <span class="string">----------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2020-03-21 15:57:49.720468:</span> <span class="string">I</span> <span class="string">tensorflow/stream_executor/platform/default/dso_loader.cc:44]</span> <span class="string">Successfully</span> <span class="string">opened</span> <span class="string">dynamic</span> <span class="string">library</span> <span class="string">cublas64_10.dll</span></span><br><span class="line"><span class="attr">2020-03-21 15:57:50.521308:</span> <span class="string">I</span> <span class="string">tensorflow/stream_executor/platform/default/dso_loader.cc:44]</span> <span class="string">Successfully</span> <span class="string">opened</span> <span class="string">dynamic</span> <span class="string">library</span> <span class="string">cudnn64_7.dll</span></span><br><span class="line"><span class="attr">2020-03-21 15:57:52.768875:</span> <span class="string">W</span> <span class="string">tensorflow/stream_executor/gpu/redzone_allocator.cc:312]</span> <span class="attr">Internal:</span> <span class="string">Invoking</span> <span class="string">GPU</span> <span class="string">asm</span> <span class="string">compilation</span> <span class="string">is</span> <span class="string">supported</span> <span class="string">on</span> <span class="string">Cuda</span> <span class="string">non-Windows</span> <span class="string">platforms</span> <span class="string">only</span></span><br><span class="line"><span class="string">Relying</span> <span class="string">on</span> <span class="string">driver</span> <span class="string">to</span> <span class="string">perform</span> <span class="string">ptx</span> <span class="string">compilation.</span> <span class="string">This</span> <span class="string">message</span> <span class="string">will</span> <span class="string">be</span> <span class="string">only</span> <span class="string">logged</span> <span class="string">once.</span></span><br><span class="line"><span class="string">[-4.032246,</span> <span class="number">6.499766</span><span class="string">,</span> <span class="number">5.2396355</span><span class="string">,</span> <span class="number">33.076145</span><span class="string">]</span></span><br><span class="line"> <span class="string">预测结果为</span> <span class="string">第</span> <span class="string">&gt;</span> <span class="number">1</span> <span class="string">&lt;</span> <span class="string">张图片</span></span><br><span class="line"></span><br><span class="line"><span class="string">--------</span>   <span class="string">坐标查找</span>    <span class="string">----------</span></span><br><span class="line"></span><br><span class="line"><span class="string">最高得分区域</span> <span class="string">(340,</span> <span class="number">300</span><span class="string">,</span> <span class="number">430</span><span class="string">,</span> <span class="number">420</span><span class="string">)</span> <span class="string">得分为</span> <span class="number">4</span></span><br><span class="line"><span class="string">中心点坐标为</span> <span class="string">(385,</span> <span class="number">360</span><span class="string">)</span></span><br><span class="line"><span class="string">move</span> <span class="string">to</span> <span class="bullet">-</span> <span class="string">&gt;</span> <span class="string">(385,</span> <span class="number">360</span><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">--------</span>   <span class="string">截图</span>    <span class="string">----------</span></span><br><span class="line"></span><br><span class="line"><span class="string">梦幻西游</span> <span class="string">ONLINE</span> <span class="bullet">-</span> <span class="string">(xxx[xxx]</span> <span class="bullet">-</span> <span class="string">xxxxxx[xxxxxxx])</span></span><br><span class="line"><span class="string">img_desktop</span> <span class="string">save</span> <span class="string">to</span> <span class="string">-&gt;</span> <span class="string">D:\gitRepo\mhxy\images\desktop.jpg</span></span><br><span class="line"><span class="string">img_mhxy</span> <span class="string">save</span> <span class="string">to</span> <span class="string">-&gt;</span> <span class="string">D:\gitRepo\mhxy\images\mhxy.jpg</span></span><br><span class="line"><span class="string">中心点坐标为</span> <span class="string">(389,</span> <span class="number">380</span><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">--------</span>   <span class="string">相对移动</span> <span class="string">点击</span>    <span class="string">----------</span></span><br><span class="line"></span><br><span class="line"><span class="string">move</span> <span class="string">rel</span> <span class="bullet">-</span> <span class="string">&gt;</span> <span class="string">(12,</span> <span class="number">-5</span><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">================</span>    <span class="string">结束</span> <span class="string">耗时</span> <span class="number">6.018</span>    <span class="string">===================</span></span><br><span class="line"><span class="string">=============================================================</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h3><p>到这里，我们的目标已经<strong>基本</strong>完毕<br><img src="http://images.di1shuai.com/Fo8_Kl6JeYnguB5APjcmhkHIZdd_" alt><br>为什么说是<strong>基本</strong>呢?</p>
<hr>
<h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><p>本人无任何商业目的，仅用于学习和娱乐，<a href="https://github.com/BestBurning/mhxy" target="_blank" rel="noopener">源代码</a>采用了<a href="https://opensource.org/licenses/AGPL-3.0" target="_blank" rel="noopener">AGPL3.0</a>开源协议</p>
<p>本文为博主原创文章，任何人未经过博主同意不得转载</p>

      <script>
        window.disqusProxy={
          shortname: 'diyishuai',
          username: 'di1shuai',
          server: 'disqus.di1shuai.com',
          port: 443,
          adminAvatar: '/avatars/admin-avatar.jpg',
          identifier: 'tensorflow实践：梦幻西游人物弹窗识别（四）.html',
        };
        window.disqus_config = function () {
          this.page.url = window.location.href;
          this.page.identifier = window.disqusProxy.identifier;
        };
      </script></div><div class="tags"><a href="/tags/Windows/"><i class="fa fa-tag"></i>Windows</a><a href="/tags/tensorflow/"><i class="fa fa-tag"></i>tensorflow</a><a href="/tags/梦幻西游/"><i class="fa fa-tag"></i>梦幻西游</a></div><div class="post-nav"><a class="pre" href="/tensorflow实践：梦幻西游人物弹窗识别（五）.html">tensorflow实践：梦幻西游人物弹窗识别（五）</a><a class="next" href="/tensorflow实践：梦幻西游人物弹窗识别（三）.html">tensorflow实践：梦幻西游人物弹窗识别（三）</a></div>
      <script src="//cdn.bootcss.com/react/16.0.0/umd/react.production.min.js"></script>
      <script src="//cdn.bootcss.com/react-dom/16.0.0/umd/react-dom.production.min.js"></script>
      <script src="//cdn.bootcss.com/fetch/2.0.3/fetch.min.js"></script>
      <script src="//cdn.jsdelivr.net/npm/blockies-identicon@0.1.0/blockies.min.js"></script>
      <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
      <div id="disqus_proxy_thread"><script src="/scripts/hexo-disqus-proxy-primary.js" async></script><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://di1shuai.com/tensorflow实践：梦幻西游人物弹窗识别（四）.html';
    this.page.identifier = 'tensorflow实践：梦幻西游人物弹窗识别（四）.html';
    this.page.title = 'tensorflow实践：梦幻西游人物弹窗识别（四）';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//diyishuai.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//diyishuai.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://diyishuai.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://di1shuai.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/emotion/">emotion</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/products/">products</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/technology/">technology</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/Flink数据转换-Transformation.html">Flink-DataStream-Transformations</a></li><li class="post-list-item"><a class="post-list-link" href="/Kubernetes架构.html">Kubernetes架构</a></li><li class="post-list-item"><a class="post-list-link" href="/使用GithubAction推送Docker到华为镜像中心.html">使用GithubAction推送Docker到香港华为镜像中心</a></li><li class="post-list-item"><a class="post-list-link" href="/docker-compose安装单机Elasticsearch.html">docker-compose安装单机Elasticsearch</a></li><li class="post-list-item"><a class="post-list-link" href="/使用GithubAction发布Flutter项目.html">使用GithubAction发布Flutter项目-Android</a></li><li class="post-list-item"><a class="post-list-link" href="/招行积分题.html">招行积分题</a></li><li class="post-list-item"><a class="post-list-link" href="/设计模式之行为型.html">设计模式之行为型</a></li><li class="post-list-item"><a class="post-list-link" href="/Java各版本新特性.html">Java各版本新特性</a></li><li class="post-list-item"><a class="post-list-link" href="/Kafka——分区策略.html">Kafka——分区策略</a></li><li class="post-list-item"><a class="post-list-link" href="/Kafka——Rebalance过程.html">Kafka——Rebalance过程</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://blog.csdn.net/u012373815" title="Abel的博客(大数据、AI专家)" target="_blank">Abel的博客(大数据、AI专家)</a><ul></ul><a href="https://blog.csdn.net/u010416101" title="Sean的博客(大数据、AI专家)" target="_blank">Sean的博客(大数据、AI专家)</a><ul></ul><a href="https://yo-cwj.com/" title="陈文俊的博客(前端专家)" target="_blank">陈文俊的博客(前端专家)</a><ul></ul><a href="https://www.xilanhua-c7.top" title="西蓝花的博客(未知领域专家)" target="_blank">西蓝花的博客(未知领域专家)</a><ul></ul><a href="https://gaojianchao.github.io/learngit/" title="Alan的博客(AI专家)" target="_blank">Alan的博客(AI专家)</a><ul></ul><a href="https://woj.app" title="虾米的蜗居" target="_blank">虾米的蜗居</a><ul></ul><a href="https://blog.mightyherox.me" title="circlehotarux的博客" target="_blank">circlehotarux的博客</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2016-2021 <a href="/." rel="nofollow">第一帅 </a> |&nbsp;<a rel="nofollow" target="_blank" href="https://beian.miit.gov.cn"> 晋ICP备15004021号-1</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/love.js"></script><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>